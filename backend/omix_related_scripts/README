# so unfortunately there is not ONE script that will solve ALL problems!!!

# rather this is a collection of scripts that have been run, and re-run, and re-run...
# again and again until Zac and Gustaf were "happy enough" with the different
# sbml files that they imported into Omix visualisation

# BELOW I copied in the instructions from June 20th which I assume is the last ones
# At the BOTTOM the instructions for generating the 6 cytosol parts are included!

################################################################################

# because the HMR2 was not entirely in a good format, I first made some "fixes"
# hopefully these should not be needed for any other SBML files!
perl fixSBMLFile.pl ../HMRdatabase_Level3_Cobra.xml > fixed.4.xml # so I did not change anything and it still worked!!!

# then for each compartment the below lines were run

# redo S as well when I found the above bug...
perl subsetToCompartments.level3.pl fixed.4.xml s > compartmentS.xml
perl removeNonUsedEnzymes.pl compartmentS.xml # this is removing the non-used enzymes....
perl omixImport.pl compartmentS.xml s fixed.4.xml > compartmentSlayout.xml # this adds layout information to the file (where transport metabolites are in one pile and enzymes another)
cp test test2
perl -p -i -e "s/^E/grep 'E/" test2
perl -p -i -e "s/\n/' compartmentSlayout.xml \| head -1 | grep -v boundaryCondition \n/" test2
bash test2 # 1 found


################################################################################

# 2016-10-17 - divide the groups into individual sbml files
perl divideCIntoGroups.pl
# remove the metabolites not refered to in a valid reaction
perl removeNonUsedMetabolitesForC.pl group1.sbml
perl removeNonUsedMetabolitesForC.pl group1.sbml
perl removeNonUsedMetabolitesForC.pl group2.sbml
perl removeNonUsedMetabolitesForC.pl group3.sbml
perl removeNonUsedMetabolitesForC.pl group4.sbml
perl removeNonUsedMetabolitesForC.pl group5.sbml
perl removeNonUsedMetabolitesForC.pl group6.sbml
perl removeNonUsedMetabolitesForC.pl groupRemaining.sbml
perl removeNonUsedMetabolitesForC.pl groupTransport.sbml
# remove the enzymes not reference to in a valid reaction
perl removeNonUsedEnzymes.pl group1.sbml
perl removeNonUsedEnzymes.pl group1.sbml
perl removeNonUsedEnzymes.pl group2.sbml
perl removeNonUsedEnzymes.pl group3.sbml
perl removeNonUsedEnzymes.pl group4.sbml
perl removeNonUsedEnzymes.pl group5.sbml
perl removeNonUsedEnzymes.pl group6.sbml
perl removeNonUsedEnzymes.pl groupRemaining.sbml
perl removeNonUsedEnzymes.pl groupTransport.sbml
wc -l group*sbml
grep "layout:x" group1.sbml | sort | uniq -c

# 2016-12-01 - duplicated metabolites, see if I can remove them...
perl divideCIntoGroups.pl
grep -c "layout:speciesGlyph" group1.sbml
grep -c "species boundaryCondition" group1.sbml
perl removeNonUsedMetabolitesForC.pl group1.sbml
grep -c "layout:speciesGlyph" group1.sbml
grep -c "species boundaryCondition" group1.sbml
egrep "layout:species=.M" group1.sbml  | sort | uniq -d

perl removeNonUsedMetabolitesForC.pl group2.sbml
perl removeNonUsedMetabolitesForC.pl group3.sbml
perl removeNonUsedMetabolitesForC.pl group4.sbml
perl removeNonUsedMetabolitesForC.pl group5.sbml
perl removeNonUsedMetabolitesForC.pl group6.sbml
perl removeNonUsedMetabolitesForC.pl groupRemaining.sbml
perl removeNonUsedMetabolitesForC.pl groupTransport.sbml
egrep "layout:species=.M" group2.sbml  | sort | uniq -d
egrep "layout:species=.M" group3.sbml  | sort | uniq -d
egrep "layout:species=.M" group4.sbml  | sort | uniq -d
egrep "layout:species=.M" group5.sbml  | sort | uniq -d
egrep "layout:species=.M" group6.sbml  | sort | uniq -d
grep "layout:x" group*.sbml | sort | uniq -c
